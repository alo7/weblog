!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.WebLog=t()}(this,function(){"use strict";function e(e,t){function i(e,a,u){u=u||1,Object.keys(e).forEach(function(c){var l=e[c],d=t.safe&&Array.isArray(l),f=Object.prototype.toString.call(l),p=o(l),h="[object Object]"===f||"[object Array]"===f,w=a?a+n+c:c;if(!d&&!p&&h&&Object.keys(l).length&&(!t.maxDepth||u<r))return i(l,w,u+1);s[w]=l})}var n=(t=t||{}).delimiter||".",r=t.maxDepth,s={};return i(e),s}function t(e,i){function n(e){var t=Number(e);return isNaN(t)||-1!==e.indexOf(".")||i.object?e:t}var r=(i=i||{}).delimiter||".",s=i.overwrite||!1,a={};return o(e)||"[object Object]"!==Object.prototype.toString.call(e)?e:(Object.keys(e).sort(function(e,t){return e.length-t.length}).forEach(function(o){for(var u=o.split(r),c=n(u.shift()),l=n(u[0]),d=a;void 0!==l;){var f=Object.prototype.toString.call(d[c]),p="[object Object]"===f||"[object Array]"===f;if(!s&&!p&&void 0!==d[c])return;(s&&!p||!s&&null==d[c])&&(d[c]="number"!=typeof l||i.object?{}:[]),d=d[c],u.length>0&&(c=n(u.shift()),l=n(u[0]))}d[c]=t(e[o],i)}),a)}function i(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}var r=function(){return(r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},o=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},s=e;e.flatten=e,e.unflatten=t;var a=function(){function e(){}return e.prototype.getItem=function(e){return S(localStorage.getItem(e))},e.prototype.setItem=function(e,t){return localStorage.setItem(e,x([t])),this.getItem(e)},e.prototype.push=function(e,t){var i=this.getItem(e);return 0===i.length?this.setItem(e,t):(i.push(t),localStorage.setItem(e,x(i)),this.getItem(e))},e.prototype.remove=function(e){localStorage.removeItem(e)},e.prototype.clear=function(){localStorage.clear()},e}(),u=function(){function e(){this.logList={}}return e.prototype.getItem=function(e){return S(this.logList[e])},e.prototype.setItem=function(e,t){return this.logList[e]=x([t]),this.getItem(e)},e.prototype.push=function(e,t){var i=this.getItem(e);return 0===i.length?this.setItem(e,t):(i.push(t),this.logList[e]=x(i),this.getItem(e))},e.prototype.remove=function(e){delete this.logList[e]},e.prototype.clear=function(){this.logList={}},e}(),c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l=n(function(e,t){!function(t,n){e.exports=function(){function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}function n(e){q=e}function r(e){V=e}function o(){return void 0!==U?function(){U(a)}:s()}function s(){var e=setTimeout;return function(){return e(a,1)}}function a(){for(var e=0;e<D;e+=2)(0,Y[e])(Y[e+1]),Y[e]=void 0,Y[e+1]=void 0;D=0}function u(e,t){var i=this,n=new this.constructor(d);void 0===n[$]&&O(n);var r=i._state;if(r){var o=arguments[r-1];V(function(){return T(r,n,o,i._result)})}else S(i,n,e,t);return n}function l(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(d);return y(i,e),i}function d(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function h(e){try{return e.then}catch(e){return ee.error=e,ee}}function w(e,t,i,n){try{e.call(t,i,n)}catch(e){return e}}function v(e,t,i){V(function(e){var n=!1,r=w(i,t,function(i){n||(n=!0,t!==i?y(e,i):_(e,i))},function(t){n||(n=!0,x(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&r&&(n=!0,x(e,r))},e)}function m(e,t){t._state===K?_(e,t._result):t._state===Z?x(e,t._result):S(t,void 0,function(t){return y(e,t)},function(t){return x(e,t)})}function g(e,i,n){i.constructor===e.constructor&&n===u&&i.constructor.resolve===l?m(e,i):n===ee?(x(e,ee.error),ee.error=null):void 0===n?_(e,i):t(n)?v(e,i,n):_(e,i)}function y(t,i){t===i?x(t,f()):e(i)?g(t,i,h(i)):_(t,i)}function b(e){e._onerror&&e._onerror(e._result),A(e)}function _(e,t){e._state===J&&(e._result=t,e._state=K,0!==e._subscribers.length&&V(A,e))}function x(e,t){e._state===J&&(e._state=Z,e._result=t,V(b,e))}function S(e,t,i,n){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+K]=i,r[o+Z]=n,0===o&&e._state&&V(A,e)}function A(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n=void 0,r=void 0,o=e._result,s=0;s<t.length;s+=3)n=t[s],r=t[s+i],n?T(i,n,r,o):r(o);e._subscribers.length=0}}function k(e,t){try{return e(t)}catch(e){return ee.error=e,ee}}function T(e,i,n,r){var o=t(n),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if(s=k(n,r),s===ee?(c=!0,a=s.error,s.error=null):u=!0,i===s)return void x(i,p())}else s=r,u=!0;i._state!==J||(o&&u?y(i,s):c?x(i,a):e===K?_(i,s):e===Z&&x(i,s))}function j(e,t){try{t(function(t){y(e,t)},function(t){x(e,t)})}catch(t){x(e,t)}}function E(){return te++}function O(e){e[$]=te++,e._state=void 0,e._result=void 0,e._subscribers=[]}function L(){return new Error("Array Methods must be provided an Array")}function I(e){return new ie(this,e).promise}function M(e){var t=this;return new t(R(e)?function(i,n){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(i,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function N(e){var t=new this(d);return x(t,e),t}function C(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function P(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function B(){var e=void 0;if(void 0!==c)e=c;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=ne}var z=void 0,R=z=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},D=0,U=void 0,q=void 0,V=function(e,t){Y[D]=e,Y[D+1]=t,2===(D+=2)&&(q?q(a):Q())},G="undefined"!=typeof window?window:void 0,F=G||{},W=F.MutationObserver||F.WebKitMutationObserver,H="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),X="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Y=new Array(1e3),Q=void 0;Q=H?function(){return function(){return process.nextTick(a)}}():W?function(){var e=0,t=new W(a),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}():X?function(){var e=new MessageChannel;return e.port1.onmessage=a,function(){return e.port2.postMessage(0)}}():void 0===G&&"function"==typeof i?function(){try{var e=Function("return this")().require("vertx");return U=e.runOnLoop||e.runOnContext,o()}catch(e){return s()}}():s();var $=Math.random().toString(36).substring(2),J=void 0,K=1,Z=2,ee={error:null},te=0,ie=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(d),this.promise[$]||O(this.promise),R(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?_(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&_(this.promise,this._result))):x(this.promise,L())}return e.prototype._enumerate=function(e){for(var t=0;this._state===J&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===l){var r=h(e);if(r===u&&e._state!==J)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(i===ne){var o=new i(d);g(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,i){var n=this.promise;n._state===J&&(this._remaining--,e===Z?x(n,i):this._result[t]=i),0===this._remaining&&_(n,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;S(e,void 0,function(e){return i._settledAt(K,t,e)},function(e){return i._settledAt(Z,t,e)})},e}(),ne=function(){function e(t){this[$]=E(),this._result=this._state=void 0,this._subscribers=[],d!==t&&("function"!=typeof t&&C(),this instanceof e?j(this,t):P())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var i=this,n=i.constructor;return t(e)?i.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):i.then(e,e)},e}();return ne.prototype.then=u,ne.all=I,ne.race=M,ne.resolve=l,ne.reject=N,ne._setScheduler=n,ne._setAsap=r,ne._asap=V,ne.polyfill=B,ne.Promise=ne,ne}()}()}).Promise,d=function(){function e(){}return e.prototype.get=function(e,t,i){return this.createAjax(e,"GET",t,i)},e.prototype.post=function(e,t,i){return this.createAjax(e,"POST",t,i)},e.prototype.createAjax=function(e,t,i,n){var r=this,o=new XMLHttpRequest,s=!1,a=setTimeout(function(){s=!0,o.abort()},3e3);return new l(function(u,c){o.addEventListener("abort",function(){c("当前日志超时3秒，未被发送。当前日志为:"+i)},!1),o.onreadystatechange=function(){if(4===o.readyState){if(s)return;clearTimeout(a),2===Math.floor(o.status/100)?u(o.responseText):c(o.status)}},o.open(t,e),r.setHeader(o,n),o.send(i)})},e.prototype.setHeader=function(e,t){void 0===t&&(t={});for(var i=t,n=Object.keys(i),r=n.length;r--;){var o=n[r],s=t[o];e.setRequestHeader(o,s)}},e}(),f=function(){function e(){}return e.prototype.get=function(e,t,i){return this.createAjax(e,"GET",t||"",i)},e.prototype.post=function(e,t,i){return this.createAjax(e,"POST",t||"",i)},e.prototype.createAjax=function(e,t,i,n){var r=this,o=0===e.indexOf("http://")?require("http"):require("https");return new l(function(s,a){var u=o.request(r.urlToOptions(e,t,i,n),function(e){2!==Math.floor(e.statusCode/100)&&a(e.statusCode),e.on("data",function(e){s(e.toString())})}).setTimeout(3e3,function(){u.abort()}).on("abort",function(e){a("当前日志超时3秒，未被发送。当前日志为:"+i)}).on("error",function(e){a(e)});u.write(i),u.end()})},e.prototype.urlToOptions=function(e,t,i,n){void 0===n&&(n={});var o=new(0,require("url").URL)(e),s=o.hostname,a=o.port,u=o.protocol,c=o.pathname;return{hostname:s,port:Number(a)||"http:"===u?80:443,path:c,method:t,headers:r({},n,{"Content-Length":Buffer.byteLength(i)})}},e}(),p=console,h=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)})},w=function(){return(new Date).getTime()},v=function(){return"object"==typeof window},m=function(e,t){return e.some(function(e){return e===t})},g=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!e.every(function(e){return!Boolean(e)||""!==e.toString().trim()})},y=function(e){var t=e;for(var i in t)if({}.hasOwnProperty.call(t,i)&&"object"==typeof t[i])return-1!==i.indexOf("__")&&(t[i.replace(/_+/,"_")]=t[i],delete t[i]),s(t,{delimiter:"__"});return t},b=function(e){p=e},_=function(e,t){p[e]("[WebLog]: "+t)},x=function(e){if(null===e||void 0===e)return"";try{return JSON.stringify(e)}catch(e){return""}},S=function(e){if(!e)return[];try{return JSON.parse(e)}catch(e){return[]}},A=function(){if(!v())return"pc";var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:Android)/.test(e),n=/(?:Firefox)/.test(e),r=/(?:iPad|PlayBook)/.test(e)||i&&!/(?:Mobile)/.test(e)||n&&/(?:Tablet)/.test(e);return/(?:iPhone)/.test(e)&&!r?"iphone":i?"android":t?"WindowsPhone":r?"pad":"unknown"},k=v()?new d:new f,T=v()?new a:new u,j=s,E=Object.freeze({getUUID:h,getTimestamp:w,isBrowser:v,includes:m,isEmpty:g,flattenPayload:y,setConsole:b,message:_,stringify:x,parse:S,getDeviceType:A,http:k,storage:T,flat:j}),O=n(function(e,t){!function(i,n){var r="model",o="name",s="type",a="vendor",u="version",c="mobile",l="tablet",d={extend:function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},f={rgx:function(e,t){for(var i,n,r,o,s,a,u=0;u<t.length&&!s;){var c=t[u],l=t[u+1];for(i=n=0;i<c.length&&!s;)if(s=c[i++].exec(e))for(r=0;r<l.length;r++)a=s[++n],"object"==typeof(o=l[r])&&o.length>0?2==o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,a):this[o[0]]=o[1]:3==o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=a?a.replace(o[1],o[2]):void 0:this[o[0]]=a?o[1].call(this,a,o[2]):void 0:4==o.length&&(this[o[0]]=a?o[3].call(this,a.replace(o[1],o[2])):void 0):this[o]=a||void 0;u+=2}},str:function(e,t){for(var i in t)if("object"==typeof t[i]&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(d.has(t[i][n],e))return"?"===i?void 0:i}else if(d.has(t[i],e))return"?"===i?void 0:i;return e}},p={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},h={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[o,u],[/(opios)[\/\s]+([\w\.]+)/i],[[o,"Opera Mini"],u],[/\s(opr)\/([\w\.]+)/i],[[o,"Opera"],u],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[o,u],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[o,"IE"],u],[/(edge|edgios|edgea)\/((\d+)?[\w\.]+)/i],[[o,"Edge"],u],[/(yabrowser)\/([\w\.]+)/i],[[o,"Yandex"],u],[/(puffin)\/([\w\.]+)/i],[[o,"Puffin"],u],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[o,"UCBrowser"],u],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],u],[/(micromessenger)\/([\w\.]+)/i],[[o,"WeChat"],u],[/(qqbrowserlite)\/([\w\.]+)/i],[o,u],[/(QQ)\/([\d\.]+)/i],[o,u],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[o,u],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[o,u],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[o,u],[/(MetaSr)[\/\s]?([\w\.]+)/i],[o],[/(LBBROWSER)/i],[o],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[u,[o,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[u,[o,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[u,[o,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[o,/(.+)/,"$1 WebView"],u],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[o,/(.+(?:g|us))(.+)/,"$1 $2"],u],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[u,[o,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[o,u],[/(dolfin)\/([\w\.]+)/i],[[o,"Dolphin"],u],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[o,"Chrome"],u],[/(coast)\/([\w\.]+)/i],[[o,"Opera Coast"],u],[/fxios\/([\w\.-]+)/i],[u,[o,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[u,[o,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[u,o],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[o,"GSA"],u],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[o,[u,f.str,p.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[o,u],[/(navigator|netscape)\/([\w\.-]+)/i],[[o,"Netscape"],u],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[o,u]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",d.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",d.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",d.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[r,a,[s,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[r,[a,"Apple"],[s,l]],[/(apple\s{0,1}tv)/i],[[r,"Apple TV"],[a,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[a,r,[s,l]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[r,[a,"Amazon"],[s,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[r,f.str,p.device.amazon.model],[a,"Amazon"],[s,c]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[r,a,[s,c]],[/\((ip[honed|\s\w*]+);/i],[r,[a,"Apple"],[s,c]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[a,r,[s,c]],[/\(bb10;\s(\w+)/i],[r,[a,"BlackBerry"],[s,c]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[r,[a,"Asus"],[s,l]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[a,"Sony"],[r,"Xperia Tablet"],[s,l]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[r,[a,"Sony"],[s,c]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[a,r,[s,"console"]],[/android.+;\s(shield)\sbuild/i],[r,[a,"Nvidia"],[s,"console"]],[/(playstation\s[34portablevi]+)/i],[r,[a,"Sony"],[s,"console"]],[/(sprint\s(\w+))/i],[[a,f.str,p.device.sprint.vendor],[r,f.str,p.device.sprint.model],[s,c]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[a,r,[s,l]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[a,[r,/_/g," "],[s,c]],[/(nexus\s9)/i],[r,[a,"HTC"],[s,l]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[r,[a,"Huawei"],[s,c]],[/(microsoft);\s(lumia[\s\w]+)/i],[a,r,[s,c]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[r,[a,"Microsoft"],[s,"console"]],[/(kin\.[onetw]{3})/i],[[r,/\./g," "],[a,"Microsoft"],[s,c]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[r,[a,"Motorola"],[s,c]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[r,[a,"Motorola"],[s,l]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[a,d.trim],[r,d.trim],[s,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[r,/^/,"SmartTV"],[a,"Samsung"],[s,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[r,[a,"Sharp"],[s,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[a,"Samsung"],r,[s,l]],[/smart-tv.+(samsung)/i],[a,[s,"smarttv"],r],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[a,"Samsung"],r,[s,c]],[/sie-(\w*)/i],[r,[a,"Siemens"],[s,c]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[a,"Nokia"],r,[s,c]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[r,[a,"Acer"],[s,l]],[/android.+([vl]k\-?\d{3})\s+build/i],[r,[a,"LG"],[s,l]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[a,"LG"],r,[s,l]],[/(lg) netcast\.tv/i],[a,r,[s,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[r,[a,"LG"],[s,c]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[r,[a,"Lenovo"],[s,l]],[/linux;.+((jolla));/i],[a,r,[s,c]],[/((pebble))app\/[\d\.]+\s/i],[a,r,[s,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[a,r,[s,c]],[/crkey/i],[[r,"Chromecast"],[a,"Google"]],[/android.+;\s(glass)\s\d/i],[r,[a,"Google"],[s,"wearable"]],[/android.+;\s(pixel c)\s/i],[r,[a,"Google"],[s,l]],[/android.+;\s(pixel xl|pixel)\s/i],[r,[a,"Google"],[s,c]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[r,/_/g," "],[a,"Xiaomi"],[s,c]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[r,/_/g," "],[a,"Xiaomi"],[s,l]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[r,[a,"Meizu"],[s,l]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[r,[a,"OnePlus"],[s,c]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[r,[a,"RCA"],[s,l]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[r,[a,"Dell"],[s,l]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[r,[a,"Verizon"],[s,l]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[a,"Barnes & Noble"],r,[s,l]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[r,[a,"NuVision"],[s,l]],[/android.+;\s(k88)\sbuild/i],[r,[a,"ZTE"],[s,l]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[r,[a,"Swiss"],[s,c]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[r,[a,"Swiss"],[s,l]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[r,[a,"Zeki"],[s,l]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[a,"Dragon Touch"],r,[s,l]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[r,[a,"Insignia"],[s,l]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[r,[a,"NextBook"],[s,l]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[a,"Voice"],r,[s,c]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[a,"LvTel"],r,[s,c]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[r,[a,"Envizen"],[s,l]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[a,r,[s,l]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[r,[a,"MachSpeed"],[s,l]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[a,r,[s,l]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[r,[a,"Rotor"],[s,l]],[/android.+(KS(.+))\s+build/i],[r,[a,"Amazon"],[s,l]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[a,r,[s,l]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[s,d.lowerize],a,r],[/(android[\w\.\s\-]{0,9});.+build/i],[r,[a,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[u,[o,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[o,u],[/rv\:([\w\.]{1,9}).+(gecko)/i],[u,o]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[o,u],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[o,[u,f.str,p.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[o,"Windows"],[u,f.str,p.os.windows.version]],[/\((bb)(10);/i],[[o,"BlackBerry"],u],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[o,u],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[o,"Symbian"],u],[/\((series40);/i],[o],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[o,"Firefox OS"],u],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[o,u],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[o,"Chromium OS"],u],[/(sunos)\s?([\w\.\d]*)/i],[[o,"Solaris"],u],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[o,u],[/(haiku)\s(\w+)/i],[o,u],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[u,/_/g,"."],[o,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[o,"Mac OS"],[u,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]*)/i],[o,u]]},w=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof w))return new w(e,t).getResult();var n=e||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),r=t?d.extend(h,t):h;return this.getBrowser=function(){var e={name:void 0,version:void 0};return f.rgx.call(e,n,r.browser),e.major=d.major(e.version),e},this.getCPU=function(){var e={architecture:void 0};return f.rgx.call(e,n,r.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return f.rgx.call(e,n,r.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return f.rgx.call(e,n,r.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return f.rgx.call(e,n,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this};w.VERSION="0.7.18",w.BROWSER={NAME:o,MAJOR:"major",VERSION:u},w.CPU={ARCHITECTURE:"architecture"},w.DEVICE={MODEL:r,VENDOR:a,TYPE:s,CONSOLE:"console",MOBILE:c,SMARTTV:"smarttv",TABLET:l,WEARABLE:"wearable",EMBEDDED:"embedded"},w.ENGINE={NAME:o,VERSION:u},w.OS={NAME:o,VERSION:u},e.exports&&(t=e.exports=w),t.UAParser=w;var v=i&&(i.jQuery||i.Zepto);if(void 0!==v){var m=new w;v.ua=m.getResult(),v.ua.get=function(){return m.getUA()},v.ua.set=function(e){m.setUA(e);var t=m.getResult();for(var i in t)v.ua[i]=t[i]}}}("object"==typeof window?window:c)}),L=(O.UAParser,v()?{}:require("os")),I=function(){return v()?navigator.userAgent:""},M=function(e){var t=e.network_type,i={name:"",version:"",network_type:"",language:"",payload:{}};if(v()){var n=(new O).getOS(),o=n.name,s=n.version;return r({},i,{name:o||"",version:s||"",network_type:t,language:navigator.language||"zh-cn"})}var a=require("os"),u=a.platform(),o="darwin"===u?"mac":"win32"===u?"windows":"linux",c=process.env,l=c.LC_ALL||c.LC_MESSAGES||c.LANG||c.LANGUAGE||"zh-cn";return r({},i,{name:o,version:a.release(),network_type:t,language:l,payload:{}})},N=function(e){var t=e.name,i=e.model,n=e.manufacturer,o={manufacturer:"",model:"",type:"",resolution:e.resolution,name:t,memory:0,cpu:0,machineId:e.machineId,payload:{}};if(v()){var s=new O,a=s.getDevice().vendor;return r({},o,{manufacturer:n||a||"",model:i||s.getDevice().model||"",type:A()||"",resolution:window.screen.width+"x"+window.screen.height,cpu:navigator.hardwareConcurrency||0})}return r({},o,{manufacturer:n||"",model:i||L.type(),type:"pc",name:L.hostname(),cpu:L.cpus().length,memory:L.totalmem()/1048576})},C=function(){var e={name:"",version:"",payload:{}};if(v()){var t=(new O).getBrowser(),i=t.name,n=t.version;return r({},e,{name:i||"",version:n||""})}return r({},e,{name:"Node",version:process.version||""})},P=function(e,t){return t.entry(e)},B=function(e){var t=e.sendMode,i=e.cacheSpace,n=e.completeLog,r=e.eventConfig,o=e.plugins,s="",a=[],u=!1;r?(s=r.behavior||"event",a=r.senders||Object.keys(o),u=r.isImmediately||!1):(s="event",a=Object.keys(o),u=!1);var c=a.filter(function(e){return"object"==typeof o[e]});if(0===c.length)return _("warn","由于没有匹配的插件，此条日志不会发送到任何平台。当条日志为 => "+JSON.stringify(n)),{};var l=function(){for(var e={},t=0;t<c.length;t++)e["WebLog_"+c[t]]=!1;return e}(),d=[n,{behavior:s}],f={immediately:function(e){return P([d],o[e])},amount:function(e){var t="WebLog_"+e;T.push(t,d);var n=T.getItem(t);n.length>=i&&(P(n,o[e]),T.remove(t))},delay:function(e){var t="WebLog_"+e;T.push(t,d),l[t]||(l[t]=setInterval(function(){0!==T.getItem(t).length&&(P(T.getItem(t),o[e]),T.remove(t))},1e3*i))}},p={};return c.forEach(function(e){var i=function(){p[e]=f.immediately(e)},n=function(){"immediately"===t?i():f[t](e)};if(u)return void i();var r=o[e].immediatelyList;if(void 0===r)n();else{for(var a=0;a<r.length;a++)if(r[a]===s)return void i();n()}}),p},z=function(e){var t=e.env,i=e.device,n=e.app;return"string"!=typeof t?(_("error","env环境必须为字符串"),!1):"string"!=typeof i.name?(_("error","deviceName必须为字符串"),!1):!g(n.name,n.type,n.version,n.channel,n.build)||(_("error","app信息不能为空"),!1)},R=function(e){for(var t in e)if({}.hasOwnProperty.call(e,t)){var i=e[t];if("object"!=typeof i||"function"!=typeof i.constructor)return _("warn",t+"插件注册失败: 必须是实例之后的对象"),!1;if(i.isInstanceError)return!1;if("function"!=typeof i.entry)return _("warn",t+"插件注册失败: 必须实现一个entry方法，用于设置日志、验证日志、转化日志、发送日志的入口"),!1;if(2!==i.entry.length)return _("warn",t+"插件注册失败: entry方法，必须有两个参数。用于接收日志库返回的日志，和发送完毕之后的回调函数"),!1;if("function"!=typeof i.setUtils)return _("warn",t+"插件注册失败: 必须实现一个setUtils方法，用于接受日志库的工具类"),!1}return!0},D=function(e,t,i,n,r){if("string"!=typeof e)return _("error","发送event事件时，第一个参数必须为字符串"),!1;if(g()&&"string"==typeof t)return _("error","发送event事件时，第二个参数必须为字符串"),!1;if(g()&&"[object Object]"==={}.toString.call(i))return _("error","发送event事件时，第三个参数必须为对象或留空"),!1;if(g()&&!m(["debug","info","warn","error"],n))return _("error","发送event事件时，第四个参数必须为debug, info, warn, error中的一个或留空"),!1;if(g()){if("[object Object]"!=={}.toString.call(r))return _("error","发送event事件时，第五个参数必须为对象或留空"),!1;var o=r.senders,s=r.behavior,a=r.isImmediately;if(g()&&"[object Array]"!=={}.toString.call(o))return _("error","发送event事件时，第五个参数中的sender必须是数组或留空"),!1;if(g()&&"[object String]"!=={}.toString.call(s))return _("error","发送event事件时，第五个参数中的behavior必须是字符串或留空"),!1;if(g()&&"[object Boolean]"!=={}.toString.call(a))return _("error","发送event事件时，第五个参数中的immediately必须是布尔值或留空"),!1}return!0},U=function(e){return null==e?(_("error","设置console时，不能设置为null或undefined"),!1):"function"!=typeof e.debug?(_("error","设置console时，必须实现debug函数"),!1):"function"!=typeof e.info?(_("error","设置console时，必须实现info函数"),!1):"function"!=typeof e.warn?(_("error","设置console时，必须实现warn函数"),!1):"function"==typeof e.error||(_("error","设置console时，必须实现error函数"),!1)},q=y,V=h,G=w,F=m;return function(){function e(e){this._env="beta",this._sendMode="immediately",this._cacheSpace=10,this._plugins={},this._env=e.env||"beta",this._ua=I(),this._os=M({network_type:e.networkType||""}),this._device=N({name:e.deviceName||"",model:e.deviceModel||"",manufacturer:e.manufacturer||"",resolution:e.resolution||"",machineId:e.machineId||V()}),this._sessionId=V(),this._client=C(),this.setApp(e.app),this.setUser(e.user),this.setLog()}return e.prototype.setSendStrategy=function(e){var t=e.sendMode,i=e.cacheSpace;"immediately"===this._sendMode&&(this._sendMode=t),this._cacheSpace=i||10},e.prototype.setPlugins=function(e){if(R(e)){this._plugins=e;for(var t in this._plugins)({}).hasOwnProperty.call(this._plugins,t)&&this._plugins[t].setUtils(E)}},e.prototype.setLogSupplementaryInfo=function(e){var t=this;Object.keys(e).forEach(function(i){var n=e[i];F(["resolution","manufacturer","deviceModel"],i)&&(t._device[i]=n),F(["networkType"],i)&&(t._os.network_type=n),"env"===i&&(t._env=n)}),this.setLog()},e.prototype.setOsPayload=function(e){this._os.payload=r({},this._os.payload,q(e))},e.prototype.setDevicePayload=function(e){this._device.payload=r({},this._device.payload,q(e))},e.prototype.setClientPayload=function(e){this._client.payload=r({},this._client.payload,q(e))},e.prototype.setAppPayload=function(e){this._app.payload=r({},this._app.payload,q(e))},e.prototype.setUser=function(e){var t=void 0===e?{id:"",type:"",payload:{}}:e,i=t.id,n=t.type,r=t.payload;this._user={id:i,type:n,payload:r}},e.prototype.setUserPayload=function(e){this._user.payload=r({},this._user.payload,q(e))},e.prototype.getLog=function(){return this._log},e.prototype.setConsole=function(e){U(e)&&b(e)},e.prototype.sendAll=function(e){var t=this;void 0===e&&(e=function(){});var i=Object.keys(this._plugins),n=!0,r=[],o=setTimeout(function(){n=!1,e()},3e3);i.forEach(function(s){var a="WebLog_"+s,u=T.getItem(a);u.length>0&&t._plugins[s].entry(u,function(t){T.remove(a),r.push(t),i.length===r.length&&(clearTimeout(o),n&&e())})})},e.prototype.event=function(e,t,i,n,r){if(!D(e,t,i,n,r))return{};var o=this.setLogExtraInfo({name:e,value:t,payload:i,level:n,timestamp:G(),uuid:V(),sessionId:this._sessionId});return z(o)?B({sendMode:this._sendMode,cacheSpace:this._cacheSpace,completeLog:o,eventConfig:r,plugins:this._plugins}):{}},e.prototype.setLog=function(){var e=this,t=e._env,i=e._ua,n=e._os,r=e._device,o=e._client,s=e._app,a=e._user;this._log={env:t,userAgent:i,os:n,device:r,client:o,app:s,user:a}},e.prototype.setLogExtraInfo=function(e){this.setLog();var t=e.name,i=e.value,n=e.level,o=e.payload,s=e.timestamp,a=e.uuid,u=e.sessionId;return r({},this.getLog(),{timestamp:s,uuid:a,sessionId:u,level:n||"info",payload:o||{},event:{name:t||"",value:i||""}})},e.prototype.setApp=function(e){if("object"!=typeof e)throw Error("App信息必须填写");var t=e.name,i=e.version,n=e.type,r=e.channel,o=e.build,s=e.payload;this._app={name:t||"",version:i||"",type:n||"",channel:r||"",build:o||"",payload:s||{}}},e.prototype.getClientPayload=function(){return this._client.payload},e}()});
